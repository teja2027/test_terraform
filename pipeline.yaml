trigger:
- main

pool:
  name: 'my-agent-pool' 

variables:
  terraformVersion: '1.12.2' # Replace with the desired Terraform version

steps:
# - task: AzureCLI@2
#   displayName: 'Login to Azure'
#   inputs:
#     azureSubscription: '<Your-Service-Connection-Name>'
#     scriptType: 'ps'
#     scriptLocation: 'inlineScript'
#     inlineScript: |
#       Write-Host "Azure CLI logged in successfully"

- task: AzureCLI@2
  displayName: 'Install Terraform on Windows VM'
  inputs:
    azureSubscription: '<Your-Service-Connection-Name>'
    scriptType: 'ps'
    scriptLocation: 'inlineScript'
    inlineScript: |
      # Define the Terraform version
      $terraformVersion = "$(terraformVersion)"

      # Download Terraform binary
      Invoke-WebRequest -Uri "https://releases.hashicorp.com/terraform/$terraformVersion/terraform_${terraformVersion}_windows_amd64.zip" -OutFile "terraform.zip"

      # Extract Terraform binary
      Expand-Archive -Path "terraform.zip" -DestinationPath "C:\Terraform"

      # Add Terraform to PATH
      $env:Path += ";C:\Terraform"

      # Verify Terraform installation
      terraform --version